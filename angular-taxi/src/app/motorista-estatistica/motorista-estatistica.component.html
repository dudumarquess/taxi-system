<p-card class="estatistica-card">
  <h2>Estatísticas do Motorista {{motorista.nome}}</h2>
  <form class="filtros" (submit)="carregarEstatisticas(); $event.preventDefault()">
    <p-text-field-wrapper label="Início">
      <input type="date" [(ngModel)]="inicio" name="inicio" />
    </p-text-field-wrapper>
    <p-text-field-wrapper label="Fim">
      <input type="date" [(ngModel)]="fim" name="fim" />
    </p-text-field-wrapper>
    <p-button type="submit">Buscar</p-button>
  </form>

  <div *ngIf="erro" class="erro">{{ erro }}</div>

  <div *ngIf="estatisticas && !erro" class="estatisticas-resumo">
    <p-text><b>Período:</b> {{inicio}} a {{fim}}</p-text>
    <ul class="estatisticas-lista">
      <li>
        <p-text>Total de viagens: <b>{{ estatisticas.totalViagens }}</b></p-text>
        <p-button (click)="onMostrarSubtotaisViagens()" size="small">Viagens por táxi</p-button>
      </li>
      <li>
        <p-text>Total de horas: <b>{{ estatisticas.totalHoras | number:'1.2-2' }}</b></p-text>
        <p-button (click)="onMostrarSubtotaisHoras()" size="small">Horas por táxi</p-button>
      </li>
      <li>
        <p-text>Total de km: <b>{{ estatisticas.totalKm | number:'1.2-2' }}</b></p-text>
        <p-button (click)="onMostrarSubtotaisKm()" size="small">Km por táxi</p-button>
      </li>
    </ul>
  </div>


  <p-card *ngIf="mostrarSubtotaisHoras" class="subtotais-card">
  <h4>Horas por táxi</h4>
  <ul>
    <li *ngFor="let s of subtotaisHoras">
      {{s.matricula}}: 
      <span
        style="cursor:pointer; color:#1976d2; text-decoration:underline"
        (click)="mostrarDetalhesViagensTaxi(s)"
      >
        <b>{{s.horas}}</b>
      </span> horas
  </li>
  </ul>
  <p-button (click)="mostrarSubtotaisHoras = false" size="small">Fechar</p-button>
</p-card>

<!-- Subtotais de viagens por táxi -->
<p-card *ngIf="mostrarSubtotaisViagens" class="subtotais-card">
  <h4>Viagens por táxi</h4>
  <ul>
    <li *ngFor="let s of subtotaisViagens">
      {{s.matricula}}:
      <span
        style="cursor:pointer; color:#1976d2; text-decoration:underline"
        (click)="mostrarDetalhesViagensTaxi(s)"
      >
        <b>{{s.viagens}}</b>
      </span> viagens
    </li>
  </ul>
  <p-button (click)="mostrarSubtotaisViagens = false" size="small">Fechar</p-button>
</p-card>

<!-- Subtotais de km por táxi -->
<p-card *ngIf="mostrarSubtotaisKm" class="subtotais-card">
  <h4>Quilómetros por táxi</h4>
  <ul>
    <li *ngFor="let s of subtotaisKm">
      {{s.matricula}}:
      <span
        style="cursor:pointer; color:#1976d2; text-decoration:underline"
        (click)="mostrarDetalhesViagensTaxi(s)"
      >
        <b>{{s.quilometros | number:'1.2-2'}}</b>
      </span> km
    </li>
  </ul>
  <p-button (click)="mostrarSubtotaisKm = false" size="small">Fechar</p-button>
</p-card>


<p-card *ngIf="mostrarDetalhesViagens" class="detalhes-card">
    <h4>{{estatisticas.totalViagens}} viagen(s) do táxi {{ taxiSelecionado?.matricula }} nas {{estatisticas.totalHoras  | number:'1.2-2' }} horas, 
        ao longo de {{estatisticas.totalKm  | number:'1.2-2' }} km  
    </h4>
    <ul>
      <li *ngFor="let v of detalhesViagens">
        <p-text>
          Viagem
          <br>
          Início: {{ v.inicio | date:'short' }}<br>
          Fim: {{ v.fim | date:'short' }}<br>
          Horas: {{ v.horas }}<br>
          Km: {{ v.quilometros | number:'1.2-2' }}<br>
          Origem: {{ v.origem?.rua }}, {{ v.origem?.cidade }}<br>
          Destino: {{ v.destino?.rua }}, {{ v.destino?.cidade }}
        </p-text>
      </li>
    </ul>
    <p-button (click)="mostrarDetalhesViagens = false" size="small">Fechar</p-button>
  </p-card>